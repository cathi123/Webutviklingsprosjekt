<h1>Bestill Hytte</h1>
<div class="row">
    <div class="col-md-6">
        <form>
            <table class="table">
                <tr>
                    <td><label for="hyttevalg">Velg hytte: </label></td>
                    <td><select id="hytteliste" onchange="updateForm()">
                            <option value="0">Månetoppen</option>
                            <option value="1">Tiurtoppen</option>
                            <option value="2">Fjellro</option>
                            <option value="3">Fjordgløtt</option>
                            <option value="4">Lykkeli</option>
                            <option value="5">Nettbua</option>
                            <option value="6">Bjørnehiet</option>
                            <option value="7">Furubo</option> 
                            <option value="8">Trollstua</option>
                    </select></td>
                </tr>
                <tr>
                    <td> <label for="dato-ankomst">Ankomst:</label> </td>
                    <td> <input type="date" id="arrival" name="dato-ankomst" required/> </td>
                </tr>
                <tr>
                    <td> <label for="dato-avreise">Avreise: </label> </td>
                    <td> <input type="date" id="departure" name="dato-avreise" required/> </td>
                </tr>
                <tr id="timeteller">
                    <td> <label for="timepris">Antall timer: <span id="timepris"></span>,-</label> </td>
                    <td> <input type="number" name="antall-timer" id="antall-timer" value="1" min="1" max="12" onchange="updateForm()" onkeyup="updateForm()">
                         Total timepris: <span id="total-timepris">,-</span></td>
                </tr>
                <tr>
                    <td> <label for="vasking">Bestill vasking: 500,- </label> </td>
                    <td> <input type="checkbox" name="vaskesjekk" id="vaskesjekk"/> </td>
                </tr>
                <tr>
                    <td> <label for="tf-medlem">Medlem av turistforeningen: -15% </label> </td>
                    <td> <input type="checkbox" name="tf-medlem" id="tf-medlem"> </td>
                </tr>
                <tr>
                    <td> <label for="fornavn">Fornavn: </label> </td>
                    <td> <input type="text" id="jim" name="fornavn" placeholder="Ola *" required> </td>
                </tr>
                <tr>
                    <td> <label for="etternavn">Etternavn: </label> </td>
                    <td> <input type="text" name="etternavn" placeholder="Nordmann *" required> </td>
                </tr>
                <tr>
                    <td> <label for="tlf">Tlf: </label> </td>
                    <td> <input type="text" name="tlf" placeholder="12345678 *" pattern="^\d{8}$" required> </td>
                </tr>
                <tr>
                    <td> <label for="email">Email: </label> </td>
                    <td> <input type="email" name="email" placeholder="olanord@example.com *" required> </td>
                </tr>
                <tr>
                    <td> <label for="ekstra-informasjon">Ekstra informasjon: </label> </td>
                    <td> <textarea name="ekstra-informasjon" wrap="soft"></textarea> </td>
                </tr>
                <tr>
                    <td><b>Totalpris:</b></td>
                    <td><span id="totalpris"></span></td>
                </tr>
            </table>
            <button class="knapp" type="submit">Bestill</button>
        </form>
    </div>
    <br>
    <div class="col-md-6" id="bestillingsoutput">
        <img class="img-responsive img-rounded" id="bestillingsbilde" src="bjørnehiet.jpg" width="340"/>
        <table class="table" id="bestillingstable">
            <tr>
                <th>Timepris: </th>
                <td id="output-timepris"></td>
                <th>Døgnpris: </th>
                <td id="output-døgnpris"></td>
            </tr>
            <tr>
                <th>Antall soverom: </th>
                <td id="output-soverom"></td>
                <th>Antall senger: </th>
                <td id="output-senger"></td>
            </tr>
            <tr>
                <th>Innlagt vann: </th>
                <td id="output-vann"></td>
                <th>Innlagt strøm: </th>
                <td id="output-strøm"></td>
            </tr>
            <tr>
                <th>Utedo: </th>
                <td id="output-utedo"></td>
                <th>Wifi: </th>
                <td id="output-wifi"></td>
            </tr>
            <tr>
                <th>Tilgang til båt: </th>
                <td id="output-båt"></td>
            </tr>

    </div>
</div>
<script>
        var hytteindex    = 0;
        var today         = new Date();
        var todayFormat   = formatDate(today)

        var timepris      = [45,    55,    70,    40,    60,    75,    50,    65,    80];
        var dognpris      = [685,   790,   905,   640,   780,   895,   690,   890,   1025];
        var soverom       = [2,     2,     3,     2,     2,     3,     2,     3,     4];
        var senger        = [4,     6,     8,     4,     5,     7,     5,     8,     12];
        var harVann       = [false, true,  true,  true,  true,  true,  false, false, true];
        var harStrom      = [false, true,  true,  false, true,  true,  false, true,  true];
        var harUtedo      = [true,  false, false, false, false, false, true,  true,  false];
        var harWifi       = [false, false, true,  false, false, true,  false, true,  true];
        var harBat        = [false, false, false, false, true,  true,  false, false, false];
        var bilder        = ["månetoppen.jpg", "tiurtoppen_stue.jpg", "fjell.jpg",
                             "fjordgløtt.jpg", "lykkeli.jpg", "nettbua.jpg",
                             "bjørnehiet.jpg", "furubo.jpg", "trollstua_stue.jpg"];

        var arrivalDate   = today;
        var departureDate = today;

        var antallDager   = 1;
        var antallTimer   = 0;
        var vaskepris     = 500;
        var medlemsrabatt = 0.15;
        var totalpris     = 0;



        updatePriceForOneDayStay(0);
        

        var arrival = document.getElementById("arrival");
        var departure = document.getElementById("departure");

        arrival.setAttribute("min", todayFormat);
        arrival.value = todayFormat;
        departure.value = todayFormat;
        updateDeparturePicker(arrivalDate);
        updateForm();

        function updateDeparturePicker(newArrivalDate) {
            // set the min date of departure to the same date as arrival
            var departureInput = document.getElementById("departure");
            departureInput.value = document.getElementById("arrival").value;
            departureInput.setAttribute("min", formatDate(newArrivalDate));
            // add 14 days
            newArrivalDate.setDate(newArrivalDate.getDate() + 14);
            // et the max date of departure to a forthnight after arrival.
            departureInput.setAttribute("max", formatDate(newArrivalDate));
        }

        // creates a string format that the html date input type can use from a javascript date datatype.
        function formatDate(theDate) {
            var dd = theDate.getDate();
            var mm = theDate.getMonth()+1; //January is 0!
            var yyyy = theDate.getFullYear();
            // add leading zeroes to date and month as the html date input type will act in unexpected
            // ways if it is not there. At the very least, I could not get max date to work
            // properly in at least one case (the date of making this), without this part.
            dd = (dd<10 ? '0'+dd: dd)
            mm = (mm<10 ? '0'+mm: mm)
            theDate = yyyy+'-'+mm+'-'+dd;
            return theDate;
        }

        function updatePriceForOneDayStay(index) {
            antallTimer = document.getElementById("antall-timer").value;
            document.getElementById("timepris").innerHTML = timepris[index];
            document.getElementById("total-timepris").innerHTML = timepris[index] * antallTimer;
            updateTotal();
        }

        function updateForm() {
            var hytteliste = document.getElementById("hytteliste");
            hytteindex = parseInt(hytteliste.selectedIndex);
            updatePriceForOneDayStay(hytteindex);
            document.getElementById("bestillingsbilde").setAttribute("src", "./images/hyttebilder/" + bilder[hytteindex]);
            document.getElementById("output-timepris").innerHTML=timepris[hytteindex];
            document.getElementById("output-døgnpris").innerHTML=dognpris[hytteindex];
            document.getElementById("output-soverom").innerHTML=soverom[hytteindex];
            document.getElementById("output-senger").innerHTML=senger[hytteindex];
            document.getElementById("output-vann").innerHTML=harVann[hytteindex] ? "Ja": "Nei";
            document.getElementById("output-strøm").innerHTML=harStrom[hytteindex] ? "Ja": "Nei";
            document.getElementById("output-utedo").innerHTML=harUtedo[hytteindex] ? "Ja": "Nei";
            document.getElementById("output-wifi").innerHTML=harWifi[hytteindex] ? "Ja": "Nei";
            
        }

        function updateTotal() {
            if (antallDager == 1) {
                totalpris = timepris[hytteindex]*antallTimer;
            } else {
                totalpris = dognpris[hytteindex]*(antallDager - 1);
            }
            if (document.getElementById("vaskesjekk").checked){
                totalpris+=vaskepris;
            }
            if (document.getElementById("tf-medlem").checked){
                totalpris-=(totalpris*medlemsrabatt);
            }
            document.getElementById("totalpris").innerHTML = totalpris;
        }

        function calculateDays(first, second) {
            var msDay = 24*60*60*1000; 
            var days = Math.round((second.getTime() - first.getTime())/(msDay));
            return days + 1;
        }

        $(document).ready(function() {

            $("#arrival").change(function() {
                setHourlyPriceVisibility();

                arrivalDate = new Date(document.getElementById("arrival").value);
                departureDate = arrivalDate;

                updateDeparturePicker(arrivalDate);
                antallDager = calculateDays(arrivalDate, departureDate);

                updateForm();
                updateTotal();
                setHourlyPriceVisibility();
            });

            $("#departure").change(function() {
                setHourlyPriceVisibility();

                arrivalDate = new Date(document.getElementById("arrival").value);
                departureDate = new Date(document.getElementById("departure").value);

                antallDager = calculateDays(arrivalDate, departureDate);

                updateForm();
                updateTotal();
            });

            $("#vaskesjekk").click(function(){
                updateTotal();
            });

            $("#tf-medlem").click(function(){
                updateTotal();
            });

            function setHourlyPriceVisibility() {
                if ($("#arrival").val() == $("#departure").val()) {
                    $("#timeteller").show();
                } else {
                    $("#timeteller").hide();
                }
            }
        });
</script>